var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);import{r as s,g as i}from"./phaser-DJkhv3Fe.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var a=s();const n=i(a);class r{constructor(t){e(this,"stopwatch"),e(this,"time"),this.time=0,this.stopwatch=t.add.text(t.scale.width-60,70,"0",{fontSize:"30px",color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(.5)}update(t,e){this.time+=e/1e3,this.stopwatch.setText(function(t){const e=Math.floor(t/60),s=Math.floor(t%60),i=Math.floor(t%1*100);return e>0?`${e}:${s<10?"0":""}${s}`:s>0?`${s<10?"0":""}${s}:${i}`:i>0?`00:${i}`:"0"}(this.time))}}class h{constructor(t){e(this,"context"),e(this,"states",new Map),e(this,"currentState"),e(this,"isSwithingState",!1),e(this,"stateQueue",[]),this.context=t}addState(t,e){var s,i,a;return this.states.set(t,{name:t,onEnter:null==(s=null==e?void 0:e.onEnter)?void 0:s.bind(this.context),onUpdate:null==(i=null==e?void 0:e.onUpdate)?void 0:i.bind(this.context),onExit:null==(a=null==e?void 0:e.onExit)?void 0:a.bind(this.context)}),this}isCurrentState(t){var e;return(null==(e=this.currentState)?void 0:e.name)===t}setState(t){var e,s;if(!this.states.has(t))throw new Error(`State ${t} does not exist`);this.isSwithingState?this.stateQueue.push(t):((null==(e=this.currentState)?void 0:e.onExit)&&this.currentState.onExit(),this.currentState=this.states.get(t),(null==(s=this.currentState)?void 0:s.onEnter)&&this.currentState.onEnter())}update(t){var e;if(this.stateQueue.length>0){const t=this.stateQueue.shift();this.setState(t)}(null==(e=this.currentState)?void 0:e.onUpdate)&&this.currentState.onUpdate(t)}}const o=new a.Events.EventEmitter;class c{constructor(t,s=20,i=1){e(this,"damage",10),e(this,"stateMachine"),e(this,"bubble"),e(this,"point"),e(this,"speedUp",.5),e(this,"radius"),e(this,"growthRate",.05),this.bubble=t,this.point=i,this.radius=s,this.stateMachine=new h(this),this.stateMachine.addState("idle",{onEnter:this.idleOnEnter}).addState("growing",{onUpdate:this.growingOnUpdate}).addState("popped",{onEnter:this.poppedOnEnter}).addState("destroyed",{onEnter:this.destroyedOnEnter}),this.stateMachine.setState("idle")}update(t){this.stateMachine.update(t)}touch(t,e){new Promise((s=>{this.stateMachine.isCurrentState("growing")&&this.bubble.getBounds().contains(t,e)&&this.stateMachine.setState("popped"),s(!0)}))}idleOnEnter(){this.stateMachine.setState("growing")}growingOnUpdate(t){this.radius+=this.growthRate*t,this.bubble.y-=this.speedUp*t,this.bubble.x+=2*Math.sin(this.bubble.y/10),this.bubble.setDisplaySize(2*this.radius,2*this.radius),this.bubble.y+this.radius<0&&this.stateMachine.setState("destroyed")}poppedOnEnter(){o.emit("bubble.popped",this),o.emit("score.marked",this.point),this.bubble.setVisible(!1),this.bubble.setActive(!1),this.bubble.destroy()}destroyedOnEnter(){o.emit("bubble.destroyed",this),this.bubble.setVisible(!1),this.bubble.setActive(!1),this.bubble.destroy()}}class l{constructor(t){e(this,"scene"),e(this,"bubbles"),e(this,"spawnWave"),e(this,"spawnTime",0),e(this,"spawnTimeInterval",1),e(this,"spawnTimeDecreseRate"),e(this,"changeSpawnTimeInterval",3),e(this,"changeSpawnTime",0),e(this,"spawnTimeMin"),e(this,"spawnWaveCount"),e(this,"spawnWaveCountMax"),e(this,"spawnWaveCountMin"),e(this,"spawnWaveCountMaxLimit"),this.scene=t,this.spawnWave=t.add.group(),this.spawnTime=0,this.spawnTimeInterval=1,this.spawnTimeDecreseRate=.1,this.spawnTimeMin=.1,this.spawnWaveCount=0,this.spawnWaveCountMax=10,this.spawnWaveCountMin=1,this.spawnWaveCountMaxLimit=10,this.bubbles=[],o.on("bubble.popped",(t=>{const e=this.bubbles.indexOf(t);e>-1&&this.bubbles.splice(e,1)})),o.on("bubble.destroyed",(t=>{const e=this.bubbles.indexOf(t);e>-1&&this.bubbles.splice(e,1)}))}update(t,e){this.spawnTime+=e/1e3,this.spawnWaveCount+=e/1e3,this.changeSpawnTime+=e/1e3,this.spawnTime>=this.spawnTimeInterval&&(this.spawnWaveCount=Math.max(this.spawnWaveCountMin,this.spawnWaveCountMax-Math.floor(this.spawnWaveCount/this.spawnWaveCountMaxLimit)),this.spawnTime=0,this.createBubbleWave()),this.changeSpawnTime>=this.changeSpawnTimeInterval&&(this.changeSpawnTime=0,this.spawnTimeInterval-=this.spawnTimeDecreseRate,this.spawnTimeInterval=Math.max(this.spawnTimeMin,this.spawnTimeInterval)),this.bubbles.forEach((t=>{t.update(e)}))}touch(t,e){Promise.all(this.bubbles.map((s=>{s.touch(t,e)})))}createBubbleWave(){const t=n.Math.Between(50,this.scene.scale.width-50),e=n.Math.Between(1e3,this.scene.scale.height),s=this.scene.add.sprite(t,e,"sphere");s.setDisplaySize(100,100),this.bubbles.push(new c(s))}}class d extends a.Scene{constructor(){super("Game"),e(this,"bubbles"),e(this,"countdown"),e(this,"spawnWaveController"),e(this,"stopWatch"),e(this,"score",0),e(this,"touched",!1),e(this,"health",100)}init(){this.bubbles=[],this.score=0}create(){this.cameras.main.setBackgroundColor(166648),this.scene.launch("ui"),this.stopWatch=new r(this),this.spawnWaveController=new l(this,1e3,10),this.input.on("pointerdown",(t=>{var e;this.touched||(null==(e=this.spawnWaveController)||e.touch(t.x,t.y),this.touched=!0)})),this.input.on("pointerup",(()=>{this.touched=!1,this.cameras.main.shake(100,.01)})),o.on("score.marked",(t=>{t<=0||(this.score+=t)})),o.on("bubble.destroyed",(t=>{this.cameras.main.shake(100,.01),this.cameras.main.flash(50,16711680),this.health-=t.damage,this.health<=0&&(this.scene.stop("ui"),this.scene.stop(),o.off("bubble.popped"),o.off("score.marked"),this.scene.start("GameOver",{score:this.score}))})),this.setBackground()}update(t,e){var s,i,a;this.bubbles.forEach((t=>{t.update(e)})),null==(s=this.spawnWaveController)||s.update(t,e),null==(i=this.countdown)||i.update(e),null==(a=this.stopWatch)||a.update(t,e)}setBackground(){const t=this.scale.width,e=this.scale.height,s=document.createElement("canvas");s.width=t,s.height=e;const i=s.getContext("2d"),a=i.createLinearGradient(0,0,0,e);a.addColorStop(1,"#1e3c72"),a.addColorStop(0,"#2a5298"),i.fillStyle=a,i.fillRect(0,0,t,e),this.textures.addCanvas("bg-gradient",s),this.add.image(0,0,"bg-gradient").setOrigin(0,0).setDepth(-1)}}class u extends a.Scene{constructor(){super({key:"ui"}),e(this,"score",0),e(this,"health",100),e(this,"scoreText"),e(this,"graphics")}formatNumber(t){return new Intl.NumberFormat("fr-FR").format(t)}init(){this.score=0}create(){o.on("score.marked",(t=>{t<=0||(this.score+=t,this.refreshScore())})),o.on("bubble.destroyed",(t=>{this.setHealthBar(this.health-=t.damage)}));const t=this.add.sprite(0,0,"sphere").setScale(.2);this.scoreText=this.add.text(-t.displayWidth-20,0,this.formatNumber(this.score),{fontFamily:"Arial Black",fontSize:50,color:"#ffffff",stroke:"#000000",strokeThickness:8}).setOrigin(0,.5),this.add.container(120,70,[this.scoreText,t]),this.graphics=this.add.graphics(),this.setHealthBar(100)}refreshScore(){this.scoreText.setText(this.formatNumber(this.score))}setHealthBar(t){const e=this.cameras.main.width-20,s=Phaser.Math.Clamp(t,0,100)/100;this.graphics.clear(),this.graphics.fillStyle(8421504),this.graphics.fillRoundedRect(10,10,e,20,5),s>0&&(this.graphics.fillStyle(65280),this.graphics.fillRoundedRect(10,10,e*s,20,5))}}class p extends a.Scene{constructor(){super("MainMenu"),e(this,"bubble")}create(){this.bubble=this.add.sprite(this.cameras.main.centerX,200,"sphere"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"Bubbles",{fontFamily:"Arial Black",fontSize:70,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+90,"Survivor",{fontFamily:"Arial Black",fontSize:70,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+190,"touch to start",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.cameras.main.setBackgroundColor(166648),this.input.once("pointerdown",(()=>{this.scene.start("Game")}))}update(t,e){this.bubble.angle+=.5}}class b extends a.Scene{constructor(){super("Preloader")}init(){this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,468,32).setStrokeStyle(1,16777215);const t=this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,4,28,16777215);this.load.on("progress",(e=>{t.width=4+460*e}))}preload(){this.load.setPath("assets"),this.load.image("sphere","sphere.png")}create(){this.scene.start("MainMenu")}}class m extends a.Scene{constructor(){super("GameOver"),e(this,"score"),e(this,"bubble")}init(t){this.cameras.main.fadeIn(1e3,0,0,0),this.score=t.score}formatNumber(t){return new Intl.NumberFormat("fr-FR").format(t)}create(){this.cameras.main.setBackgroundColor(166648),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-100,"Game Over",{fontFamily:"Arial Black",fontSize:60,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.bubble=this.add.sprite(0,0,"sphere").setScale(.5);const t=this.add.text(-this.bubble.displayWidth/2-20,0,this.formatNumber(this.score),{fontFamily:"Arial Black",fontSize:50,color:"#ffffff",stroke:"#000000",strokeThickness:8}).setOrigin(0,.5);this.add.container(this.cameras.main.centerX,this.cameras.main.centerY,[t,this.bubble]);const e=this.cameras.main.centerX,s=this.add.container(e,50).setVisible(!1),i=this.add.text(0,0,"Restart",{fontSize:"24px",color:"#ffffff",fontFamily:"Arial"}).setOrigin(.5);s.setInteractive(new a.Geom.Rectangle(-100,-50,200,100),a.Geom.Rectangle.Contains),s.on("pointerdown",(()=>{this.scene.start("Game")})),s.add([i]),s.setVisible(!0)}update(){this.bubble.angle+=.5,this.bubble.setScale(.18+.02*Math.sin(this.bubble.angle*Math.PI/180))}}const f={type:a.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"game-container",backgroundColor:"#028af8",scale:{mode:a.Scale.FIT,autoCenter:a.Scale.CENTER_BOTH},scene:[b,p,d,u,m]};document.addEventListener("DOMContentLoaded",(()=>{new a.Game({...f,parent:"game-container"})}));
