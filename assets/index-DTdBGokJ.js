var t=Object.defineProperty,e=(e,i,s)=>((e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s)(e,"symbol"!=typeof i?i+"":i,s);import{r as i}from"./phaser-y5S3hZEA.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var s=i();class n{constructor(t){e(this,"context"),e(this,"states",new Map),e(this,"currentState"),e(this,"isSwithingState",!1),e(this,"stateQueue",[]),this.context=t}addState(t,e){var i,s,n;return this.states.set(t,{name:t,onEnter:null==(i=null==e?void 0:e.onEnter)?void 0:i.bind(this.context),onUpdate:null==(s=null==e?void 0:e.onUpdate)?void 0:s.bind(this.context),onExit:null==(n=null==e?void 0:e.onExit)?void 0:n.bind(this.context)}),this}isCurrentState(t){var e;return(null==(e=this.currentState)?void 0:e.name)===t}setState(t){var e,i;if(!this.states.has(t))throw new Error(`State ${t} does not exist`);this.isSwithingState?this.stateQueue.push(t):((null==(e=this.currentState)?void 0:e.onExit)&&this.currentState.onExit(),this.currentState=this.states.get(t),(null==(i=this.currentState)?void 0:i.onEnter)&&this.currentState.onEnter())}update(t){var e;if(this.stateQueue.length>0){const t=this.stateQueue.shift();this.setState(t)}(null==(e=this.currentState)?void 0:e.onUpdate)&&this.currentState.onUpdate(t)}}const r=new s.Events.EventEmitter;class o{constructor(t,i,s,r){e(this,"stateMachine"),e(this,"bubble"),e(this,"input"),e(this,"radius"),e(this,"pointer"),e(this,"growthRate",.05),e(this,"pointDeceaseRate",.4),e(this,"point",1e3),this.bubble=t,this.pointer=i,this.input=s,this.radius=r,this.stateMachine=new n(this),this.stateMachine.addState("idle",{onEnter:this.idleOnEnter}).addState("growing",{onUpdate:this.growingOnUpdate}).addState("popped",{onEnter:this.poppedOnEnter}),this.bubble.setInteractive({useHandCursor:!0}),this.input.on("pointerdown",(t=>{this.stateMachine.isCurrentState("growing")&&this.bubble.getBounds().contains(t.x,t.y)&&this.stateMachine.setState("popped")})),this.stateMachine.setState("idle")}update(t){this.stateMachine.update(t)}idleOnEnter(){this.stateMachine.setState("growing")}growingOnUpdate(t){if(!this.pointer.isDown||!this.bubble.getBounds().contains(this.pointer.x,this.pointer.y))return this.radius+=this.growthRate*t,this.bubble.setDisplaySize(2*this.radius,2*this.radius),this.point=this.point-this.pointDeceaseRate*t,this.point<=0?(this.point=0,void this.stateMachine.setState("popped")):void 0;this.stateMachine.setState("popped")}poppedOnEnter(){r.emit("bubble.popped",this.point),this.bubble.setVisible(!1),this.bubble.setActive(!1),this.bubble.destroy()}}class a{constructor(t,i,s){e(this,"countdown"),e(this,"countdownTime"),e(this,"gameOverCallback"),this.countdownTime=i,this.gameOverCallback=s,this.countdown=t.add.text(t.cameras.main.centerX,t.cameras.main.centerY-300,`${this.formatTime(this.countdownTime)}`,{fontSize:"64px",color:"#ffffff"}).setOrigin(.5)}update(t){this.countdownTime-=t/1e3,this.countdown.setText(this.formatTime(this.countdownTime)),this.countdownTime<=0&&this.gameOverCallback()}formatTime(t){const e=Math.floor(t/60),i=Math.floor(t%60),s=Math.floor(t%1*1e3);return e>0?`${e}:${i<10?"0":""}${i}`:i>0?`${i<10?"0":""}${i}:${s}`:s>0?`${s}`:void 0}}class h extends s.Scene{constructor(){super("Game"),e(this,"bubbles"),e(this,"pointer"),e(this,"bubbleSpawnRate",500),e(this,"countdown"),e(this,"score",0),e(this,"colors",[16711680,65280,255,16776960,16711935,65535,16746496,65416,8913151,8947712,8913032,34952,8947848,0])}init(){this.bubbles=[],this.pointer=this.input.activePointer,this.score=0}preload(){this.load.setPath("assets"),this.load.image("sphere","sphere.png")}create(){this.cameras.main.setBackgroundColor(166648),this.time.addEvent({delay:this.bubbleSpawnRate,callback:()=>{const t=s.Math.Between(50,this.scale.width-50),e=s.Math.Between(50,this.scale.height-50),i=this.add.sprite(t,e,"sphere");i.setDisplaySize(100,100),this.bubbles.push(new o(i,this.pointer,this.input,50))},loop:!0}),this.scene.launch("ui"),this.countdown=new a(this,10,(()=>{this.scene.stop("ui"),this.scene.stop(),r.off("bubble.popped"),this.scene.start("GameOver",{score:this.score})})),r.on("bubble.popped",(t=>{t<=0||(this.score+=t)}))}update(t,e){var i;this.bubbles.forEach((t=>{t.update(e)})),null==(i=this.countdown)||i.update(e)}}class c extends s.Scene{constructor(){super({key:"ui"}),e(this,"coinLabel"),e(this,"score",0)}formatNumber(t){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(t)}init(){this.score=0}create(){this.coinLabel=this.add.text(36,36,"Score : 0",{fontSize:32}),r.on("bubble.popped",(t=>{t<=0||(this.score+=t,this.showPointScored(this.formatNumber(t)),this.coinLabel.setText("Score : "+this.formatNumber(this.score)))}))}showPointScored(t){const e=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`+${t}`,{fontSize:64,color:"#00ff00"}).setOrigin(.5);this.tweens.add({targets:e,y:e.y-50,alpha:0,duration:1e3,ease:"Power2",onComplete:()=>{e.destroy()}})}}class u extends s.Scene{constructor(){super("GameOver"),e(this,"score")}init(t){this.score=t.score}formatNumber(t){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(t)}create(){this.cameras.main.setBackgroundColor(0),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-100,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Score: ${this.formatNumber(this.score)}`,{fontFamily:"Arial Black",fontSize:32,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("Game")}))}}const d={type:s.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"game-container",backgroundColor:"#028af8",scale:{mode:s.Scale.FIT,autoCenter:s.Scale.CENTER_BOTH},scene:[h,c,u]};document.addEventListener("DOMContentLoaded",(()=>{new s.Game({...d,parent:"game-container"})}));
