var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);import{r as s}from"./phaser-y5S3hZEA.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var i=s();class n{constructor(t){e(this,"context"),e(this,"states",new Map),e(this,"currentState"),e(this,"isSwithingState",!1),e(this,"stateQueue",[]),this.context=t}addState(t,e){var s,i,n;return this.states.set(t,{name:t,onEnter:null==(s=null==e?void 0:e.onEnter)?void 0:s.bind(this.context),onUpdate:null==(i=null==e?void 0:e.onUpdate)?void 0:i.bind(this.context),onExit:null==(n=null==e?void 0:e.onExit)?void 0:n.bind(this.context)}),this}isCurrentState(t){var e;return(null==(e=this.currentState)?void 0:e.name)===t}setState(t){var e,s;if(!this.states.has(t))throw new Error(`State ${t} does not exist`);this.isSwithingState?this.stateQueue.push(t):((null==(e=this.currentState)?void 0:e.onExit)&&this.currentState.onExit(),this.currentState=this.states.get(t),(null==(s=this.currentState)?void 0:s.onEnter)&&this.currentState.onEnter())}update(t){var e;if(this.stateQueue.length>0){const t=this.stateQueue.shift();this.setState(t)}(null==(e=this.currentState)?void 0:e.onUpdate)&&this.currentState.onUpdate(t)}}const a=new i.Events.EventEmitter;class r{constructor(t,s,i=1e3,a=1){e(this,"stateMachine"),e(this,"bubble"),e(this,"point"),e(this,"speedUp",.5),e(this,"radius"),e(this,"growthRate",.15),e(this,"pointDeceaseRate",.5),this.bubble=t,this.point=i,this.radius=s,this.pointDeceaseRate=a,this.stateMachine=new n(this),this.stateMachine.addState("idle",{onEnter:this.idleOnEnter}).addState("growing",{onUpdate:this.growingOnUpdate}).addState("popped",{onEnter:this.poppedOnEnter}),this.stateMachine.setState("idle")}update(t){this.stateMachine.update(t)}touch(t,e){new Promise((s=>{this.stateMachine.isCurrentState("growing")&&this.bubble.getBounds().contains(t,e)&&this.stateMachine.setState("popped"),s(!0)}))}idleOnEnter(){this.stateMachine.setState("growing")}growingOnUpdate(t){if(this.radius+=this.growthRate*t,this.bubble.y-=this.speedUp*t,this.bubble.setDisplaySize(2*this.radius,2*this.radius),this.point=this.point-this.pointDeceaseRate*t,this.point<=0)return this.point=0,void this.stateMachine.setState("popped")}poppedOnEnter(){a.emit("bubble.popped",this),a.emit("score.marked",this.point),this.bubble.setVisible(!1),this.bubble.setActive(!1),this.bubble.destroy()}}class o{constructor(t,s,i){e(this,"countdown"),e(this,"countdownTime"),e(this,"gameOverCallback"),this.countdownTime=s,this.gameOverCallback=i,this.countdown=t.add.text(t.cameras.main.centerX,t.cameras.main.centerY-300,`${this.formatTime(this.countdownTime)}`,{fontSize:"64px",color:"#ffffff"}).setOrigin(.5)}update(t){this.countdownTime-=t/1e3,this.countdown.setText(this.formatTime(this.countdownTime)),this.countdownTime<=0&&this.gameOverCallback()}formatTime(t){const e=Math.floor(t/60),s=Math.floor(t%60),i=Math.floor(t%1*100);return e>0?`${e}:${s<10?"0":""}${s}`:s>0?`${s}:${i}`:i>0?`${i}`:"0"}}class h extends i.Scene{constructor(){super("Game"),e(this,"bubbles"),e(this,"bubbleSpawnRate",300),e(this,"goldBubbleSpawnRate",1e3),e(this,"goldBubblePointValue",1e4),e(this,"bubblePointValue",1e3),e(this,"countdown"),e(this,"pointDeceaseRate",1),e(this,"goldPointDeceaseRate",8),e(this,"GameLength",15),e(this,"radius",10),e(this,"score",0),e(this,"touched",!1)}init(){this.bubbles=[],this.score=0}create(){this.cameras.main.setBackgroundColor(166648),this.time.addEvent({delay:this.bubbleSpawnRate,callback:this.spwawnRegularBubble.bind(this),loop:!0}),this.scene.launch("ui"),this.countdown=new o(this,this.GameLength,(()=>{this.scene.stop("ui"),this.scene.stop(),a.off("bubble.popped"),a.off("score.marked"),this.scene.start("GameOver",{score:this.score})})),this.time.addEvent({delay:this.goldBubbleSpawnRate,callback:this.SpawnGoldBubble.bind(this),loop:!0}),this.input.on("pointerdown",(t=>{this.touched||(Promise.all(this.bubbles.map((e=>{e.touch(t.x,t.y)}))),this.touched=!0)})),this.input.on("pointerup",(()=>{this.touched=!1,this.cameras.main.shake(100,.01)})),a.on("bubble.popped",(t=>{const e=this.bubbles.indexOf(t);e>-1&&this.bubbles.splice(e,1)})),a.on("score.marked",(t=>{t<=0||(this.score+=t)}))}update(t,e){var s;this.bubbles.forEach((t=>{t.update(e)})),null==(s=this.countdown)||s.update(e)}spwawnRegularBubble(){this.spwanBubble()}SpawnGoldBubble(){this.spwanBubble(16766720,this.goldBubblePointValue,this.goldPointDeceaseRate)}spwanBubble(t,e=this.bubblePointValue,s=this.pointDeceaseRate){const n=i.Math.Between(50,this.scale.width-50),a=i.Math.Between(1e3,this.scale.height),o=this.add.sprite(n,a,"sphere");t&&o.setTint(t),o.setDisplaySize(100,100),this.bubbles.push(new r(o,this.radius,e,s))}}class c extends i.Scene{constructor(){super({key:"ui"}),e(this,"score",0)}formatNumber(t){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(t)}init(){this.score=0}create(){a.on("score.marked",(t=>{t<=0||(this.score+=t,this.showPointScored(this.formatNumber(t)))}))}showPointScored(t){const e=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`+${t}`,{fontSize:64,color:"#00ff00"}).setOrigin(.5);this.tweens.add({targets:e,y:e.y-50,alpha:0,duration:1e3,ease:"Power2",onComplete:()=>{e.destroy()}})}}class l extends i.Scene{constructor(){super("MainMenu"),e(this,"bubble")}create(){this.bubble=this.add.sprite(this.cameras.main.centerX,200,"sphere"),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"Bubbles",{fontFamily:"Arial Black",fontSize:70,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+100,"click to start",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("Game")}))}update(t,e){this.bubble.angle+=.5}}class d extends i.Scene{constructor(){super("Preloader")}init(){this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const t=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(e=>{t.width=4+460*e}))}preload(){this.load.setPath("assets"),this.load.image("sphere","sphere.png")}create(){this.scene.start("MainMenu")}}class u extends i.Scene{constructor(){super("GameOver"),e(this,"score")}init(t){this.cameras.main.fadeIn(1e3,0,0,0),this.score=t.score}formatNumber(t){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(t)}create(){this.cameras.main.setBackgroundColor(166648),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-100,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,`Score: ${this.formatNumber(this.score)}`,{fontFamily:"Arial Black",fontSize:50,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5);const t=this.scale.width/2,e=this.scale.height/2+100,s=this.add.container(t,e).setVisible(!1),n=this.add.text(0,0,"Restart",{fontSize:"24px",color:"#ffffff",fontFamily:"Arial"}).setOrigin(.5),a=this.add.rectangle(t,e,200,100,16777215,1).setOrigin(.5);s.setInteractive(new i.Geom.Rectangle(-100,-50,200,100),i.Geom.Rectangle.Contains),s.on("pointerdown",(()=>{this.scene.start("Game")})),s.add([a,n]),s.setVisible(!0)}}const b={type:i.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"game-container",backgroundColor:"#028af8",scale:{mode:i.Scale.FIT,autoCenter:i.Scale.CENTER_BOTH},scene:[d,l,h,c,u]};document.addEventListener("DOMContentLoaded",(()=>{new i.Game({...b,parent:"game-container"})}));
